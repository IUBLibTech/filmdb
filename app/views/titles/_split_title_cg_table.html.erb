<% @map.keys.each do |t_id| %>
  <% title = Title.find(t_id) %>
  <div class="split_title_div">
  <h4><%= title.title_text %></h4>
  <table>
    <tbody>
    <tr>
      <th>IU Barcode</th>
      <th>Location</th>
      <th>Gauge</th>
      <th>Generation</th>
      <th>Scan Resolution</th>
      <th>Color Space</th>
      <th>Return on Reel</th>
      <th>Clean</th>
    </tr>
    <% if @title.id == t_id %>
      <tr>
        <th colspan="8">Remaining Physical Objects</th>
      </tr>
      <% PhysicalObject.where(id: @map[t_id]).each do |p| %>
        <tr>
          <td><%= p.iu_barcode %></td>
          <td><%= p.current_location %></td>
          <td><%= p.gauge %></td>
          <td><%= p.humanize_boolean_fields(PhysicalObject::GENERATION_FIELDS) %></td>
          <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][scan_resolution", options_for_select(ComponentGroup::SCAN_RESOLUTIONS.collect{|s| [s, s]}) %></td>
          <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][color_space]", options_for_select(ComponentGroup::COLOR_SPACES.collect{|s| [s,s]}) %></td>
          <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][return_on_reel]", options_for_select([["No", false], ["Yes", true]]) %></td>
          <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][clean]", options_for_select(ComponentGroup::CLEAN.collect{|s| [s, s]}) %></td>
          <td>
            <% if p.current_location == WorkflowStatus::SHIPPED_EXTERNALLY %>
              <p class="warning">Shipped Externally</p>
            <% else %>
              <%= check_box_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][checked]", "", false,  {class: 'po_check'} %>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% else %>
      <tr>
        <th colspan="8">Existing Physical Objects</th>
      </tr>
      <% title.physical_objects.each do |p| %>
          <tr>
            <td><%= p.iu_barcode %></td>
            <td><%= p.current_location %></td>
            <td><%= p.gauge %></td>
            <td><%= p.humanize_boolean_fields(PhysicalObject::GENERATION_FIELDS) %></td>
            <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][scan_resolution", options_for_select(ComponentGroup::SCAN_RESOLUTIONS.collect{|s| [s, s]}) %></td>
            <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][color_space]", options_for_select(ComponentGroup::COLOR_SPACES.collect{|s| [s,s]}) %></td>
            <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][return_on_reel]", options_for_select([["No", false], ["Yes", true]]) %></td>
            <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][clean]", options_for_select(ComponentGroup::CLEAN.collect{|s| [s, s]}) %></td>
            <td>
              <% if p.current_location == WorkflowStatus::SHIPPED_EXTERNALLY %>
                <p class="warning">Shipped Externally</p>
              <% else %>
                <%= check_box_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][checked]", "", false,  {class: 'po_check'} %>
              <% end %>
            </td>
          </tr>
      <% end %>
      <tr>
        <th colspan="8">Retitled Physical Objects</th>
      </tr>
      <% PhysicalObject.where(id: @map[t_id]).each do |p| %>
          <tr>
            <td><%= p.iu_barcode %></td>
            <td><%= p.current_location %></td>
            <td><%= p.gauge %></td>
            <td><%= p.humanize_boolean_fields(PhysicalObject::GENERATION_FIELDS) %></td>
            <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][scan_resolution", options_for_select(ComponentGroup::SCAN_RESOLUTIONS.collect{|s| [s, s]}) %></td>
            <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][color_space]", options_for_select(ComponentGroup::COLOR_SPACES.collect{|s| [s,s]}) %></td>
            <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][return_on_reel]", options_for_select([["No", false], ["Yes", true]]) %></td>
            <td><%= select_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][clean]", options_for_select(ComponentGroup::CLEAN.collect{|s| [s, s]}) %></td>
            <td>
              <% if p.current_location == WorkflowStatus::SHIPPED_EXTERNALLY %>
                <p class="warning">Shipped Externally</p>
              <% else %>
                <%= check_box_tag "titles[#{t_id}]component_group[component_group_physical_objects_attributes][#{p.id}][checked]", "", false,  {class: 'po_check'} %>
              <% end %>
            </td>
          </tr>
      <% end %>
    <% end %>
    </tbody>
  </table>
</div>
<% end %>