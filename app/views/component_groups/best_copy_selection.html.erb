<h3>Best Copy Selection for <b><i><%= @title.title_text %></i></b></h3>
<br>
<h4>Original Best Copy Component Group</h4>
<table>
  <tbody>
  <tr>
    <th>Group Summary</th>
    <td>
      <textarea rows="4" cols="60">
        <%= @component_group.group_summary %>
      </textarea>
    </td>
  </tr>
  <tr>
    <th>IU Barcode</th>
    <th>Scan Resolution</th>
    <th>Color</th>
    <th>Return on Reel</th>
    <th>Clean</th>
    <th>Location</th>
  </tr>
  <% @component_group.physical_objects.each do |p| %>
  <tr>
    <td><%= p.iu_barcode %></td>
    <% if p.current_scan_settings.nil? %>
      <td></td><td></td><td></td><td></td>
    <% else %>
      <td><%= p.current_scan_settings.scan_resolution %></td>
      <td><%= p.current_scan_settings.color_space %></td>
      <td><%= p.current_scan_settings.return_on_reel %></td>
      <td><%= p.current_scan_settings.clean %></td>
    <% end %>
    <td><%= p.current_location %></td>
  </tr>
  <% end %>
  </tbody>
</table>
<br>
<% if @component_group.all_present? %>
<h4>New Reformatting Component Group</h4>
<p>Select physical objects you wish to add to a <b>Reformatting Component Group</b>. Unselected physical objects will be returned
  to their <i>last</i> storage location - In Storage (Ingested), In Storage (Awaiting Ingest), In Freezer, or Awaiting Freezer</p>
<%= form_tag title_component_group_best_copy_selection_create_path(@title, @component_group), method: :post do %>
  <%= hidden_field_tag 'poids' %>
  <table>
    <tbody>
    <tr>
      <th>Reformatting CG Group Summary</th>
      <td colspan="5">
        <%= text_area_tag 'group_summary' %>
      </td>
    </tr>
    <tr>
      <th>Add to CG</th>
      <th>IU Barcode</th>
      <th>Scan Resolution</th>
      <th>Color</th>
      <th>Return on Reel</th>
      <th>Clean</th>
    </tr>
    <% @component_group.physical_objects.each do |p| %>
    <tr>
      <td>
        <%= check_box_tag "po_#{p.id}", "po_#{p.id}", false,  class: 'po_check' %>
      </td>
      <td><%= p.iu_barcode %></td>
      <td><%= select_tag "po_scan_#{p.id}", options_for_select(ComponentGroup::SCAN_RESOLUTIONS.collect{|s| [s, s]}) %></td>
      <td><%= select_tag "po_color_#{p.id}", options_for_select(ComponentGroup::COLOR_SPACES.collect{|s| [s,s]}) %></td>
      <td><%= select_tag "po_return_#{p.id}", options_for_select([["No", false], ["Yes", true]]) %></td>
      <td><%= select_tag "po_clean_#{p.id}", options_for_select(ComponentGroup::CLEAN.collect{|s| [s, s]}) %></td>
    </tr>
    <% end %>
    <tr>
      <td colspan="6"><%= submit_tag "Create Reformating CG" %></td>
    </tr>
    </tbody>
  </table>
<% end %>
<% else %>
  <p class="warning">Not all physical objects are present. Reformatting Component Group cannot be created.</p>
<% end %>
<script type="text/javascript" charset="utf-8">
  var po_ids = [];
  $(document).ready(function() {
     $('.po_check').click(function() {
         po_ids = [];
         $('.po_check:checked').each(function() {
             po_ids.push($(this).attr('id').substring(3));
             $('#poids').attr('value', po_ids.join());
         })
     });
  });
</script>